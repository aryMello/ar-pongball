<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AR PongBall - Multiplayer</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <!-- Main Menu -->
    <div id="menu">
        <h1>🏓 AR PongBall</h1>
        <p class="subtitle">Next-Generation AR Multiplayer Pong</p>
        <button class="menu-btn" onclick="startSoloMode()">🤖 Solo Practice</button>
        <button class="menu-btn" onclick="showMultiplayerOptions()">👥 Multiplayer</button>
        <button class="menu-btn" onclick="showRoomSetup()">📐 Room Calibration</button>
        <button class="menu-btn" onclick="showInstructions()">📋 How to Play</button>
    </div>

    <!-- Multiplayer Options -->
    <div id="multiplayerMenu" style="display: none;">
        <h2>👥 Multiplayer Options</h2>
        <button class="menu-btn" onclick="createRoom()">🆕 Create Room</button>
        <button class="menu-btn" onclick="showJoinRoom()">🚪 Join Room</button>
        <button class="btn-secondary" onclick="backToMainMenu()">← Back</button>
        
        <div id="joinRoomSection" style="display: none; margin-top: 20px;">
            <input type="text" id="roomCodeInput" class="room-input" placeholder="Enter Room Code" maxlength="10">
            <button class="menu-btn" onclick="joinRoom()">Join Game</button>
        </div>
    </div>

    <!-- Room Setup & Calibration -->
    <div id="roomSetup">
        <h2>Room Setup & Calibration</h2>
        <p class="setup-description">Configure your play area dimensions for accurate AR tracking</p>
        
        <div class="dimension-control">
            <label>Room Width (meters):</label>
            <input type="range" id="roomWidth" min="2" max="10" step="0.1" value="4" onchange="updateRoomDimensions()">
            <span id="widthDisplay" class="dimension-value">4.0m</span>
        </div>
        
        <div class="dimension-control">
            <label>Room Depth (meters):</label>
            <input type="range" id="roomDepth" min="3" max="12" step="0.1" value="6" onchange="updateRoomDimensions()">
            <span id="depthDisplay" class="dimension-value">6.0m</span>
        </div>
        
        <div class="dimension-control">
            <label>Room Height (meters):</label>
            <input type="range" id="roomHeight" min="2" max="5" step="0.1" value="3" onchange="updateRoomDimensions()">
            <span id="heightDisplay" class="dimension-value">3.0m</span>
        </div>
        
        <div class="calibration-info">
            <p>Point your device at the floor center</p>
            <p>Walk around to map your room boundaries</p>
        </div>
        
        <button class="menu-btn" onclick="startRoomCalibration()">Start Calibration</button>
        <button class="btn-secondary" onclick="hideRoomSetup()">← Back</button>
    </div>

    <!-- Game Container -->
    <div id="gameContainer">
        <video id="videoElement" autoplay muted playsinline></video>
        <canvas id="threeCanvas"></canvas>
        
        <!-- AR Overlays -->
        <div class="gaze-indicator" id="gazeIndicator">
            <div class="crosshair"></div>
        </div>
        
        <!-- Game UI -->
        <div id="gameUI">
            <div class="status-panel">
                <div class="status info" id="connectionStatus">Initializing AR System...</div>
                <div class="status" id="gameStatus">Ready to Play</div>
            </div>
            
            <div class="score-panel">
                <div class="score-item">
                    <span class="score-label">You</span>
                    <span class="score-value" id="playerScore">0</span>
                </div>
                <div class="score-divider">:</div>
                <div class="score-item">
                    <span class="score-label">Opponent</span>
                    <span class="score-value" id="opponentScore">0</span>
                </div>
            </div>
            
            <div id="connectionInfo">
                <div class="room-info">
                    <div class="room-label">Room Code:</div>
                    <div class="room-code" id="roomCode">-</div>
                    <div class="room-share">Share with opponent</div>
                </div>
                
                <div class="player-list" id="playerList">
                    <div class="player-item">
                        <span class="player-status online">●</span>
                        <span>You</span>
                    </div>
                </div>
            </div>

        <div id="playerIdDisplay" class="player-id">Your ID: <span id="yourPlayerId">-</span></div>

        </div>

        <!-- Room Measurement Overlay -->
        <div class="measurement-overlay" id="measurementOverlay">
            <div class="measurement-title">📐 Room Measurements</div>
            <div class="measurement-item">
                <span>Width:</span> <span id="measuredWidth">4.0m</span>
            </div>
            <div class="measurement-item">
                <span>Depth:</span> <span id="measuredDepth">6.0m</span>
            </div>
            <div class="measurement-item">
                <span>Height:</span> <span id="measuredHeight">3.0m</span>
            </div>
            <div class="measurement-actions">
                <button class="btn-small" onclick="toggleGrid()">Toggle Grid</button>
                <button class="btn-small" onclick="recalibrate()">Recalibrate</button>
            </div>
        </div>

    

        <!-- Calibration Overlay -->
        <div id="calibrationOverlay" style="display: none;">
            <div class="calibration-panel">
                <h3>🎯 Calibrating AR Tracking</h3>
                <p id="calibrationStep">Step 1: Point device at floor center</p>
                <div class="calibration-progress">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                <button class="btn-secondary" onclick="skipCalibration()">Skip Calibration</button>
            </div>
        </div>
    </div>

    <!-- Loading Screen -->
    <div id="loadingScreen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2>Loading AR PongBall...</h2>
            <p id="loadingStatus">Initializing systems...</p>
        </div>
    </div>

    <script src="game.js"></script>
</body>
</html>